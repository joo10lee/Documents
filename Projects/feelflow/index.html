<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <meta name="apple-mobile-web-app-title" content="FeelFlow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/style.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/api.js"></script>  
    <script src="js/ui.js"></script>
    <script src="js/activities.js"></script> 
    <script src="js/tracker.js"></script> 
    <script src="js/app.js"></script>
    <script>
        window.onload = function() {
            console.log("FeelFlow ì¸í”„ë¼ Ver.0213-1717
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js').catch(err => console.log('SW fail:', err));
            }
            if (typeof initApp === 'function') initApp();
        };
    </script>  
    <title>FeelFlow - Build Ver.0213-1717</title>
</head>
<body>
    <header class="app-header">
        <div class="header-status">
            <span></span> <span class="build-tag">Ver.0213-1717</span>
        </div>
        <div class="header-main">
            <h1 class="greeting">Hey Joo, <br>how's it going?</h1>
        </div>
    </header>
    
    <main class="screen active" id="screen1">
        <div class="xp-container" style="padding: 10px 24px;">
            <div class="xp-header" style="display:flex; justify-content:space-between; font-size:0.8rem; font-weight:850; margin-bottom:6px;">
                <span>Level 1 Adventurer</span>
                <span id="xpText">0 XP</span>
            </div>
            <div class="xp-bar-bg" style="height:12px; background:rgba(0,0,0,0.05); border-radius:6px; overflow:hidden;">
                <div id="xpFill" style="width: 0%; height:100%; background:linear-gradient(90deg, #7c3aed, #a78bfa); transition:0.5s;"></div>
            </div>
        </div>
    
        <div class="emotion-bento">
            <button class="bento-card happy" onclick="selectEmotion('Happy', 'ğŸ˜Š', '#FFD93D')">
                <span class="emoji">ğŸ˜Š</span> <span class="label">Happy</span>
            </button>
            <button class="bento-card anxious" onclick="selectEmotion('Anxious', 'ğŸ˜°', '#A084E8')">
                <span class="emoji">ğŸ˜°</span> <span class="label">Anxious</span>
            </button>
            </div>
    
        <div class="quick-mission-section" style="padding: 10px 24px 20px;">
            <h3 class="section-title" style="margin-left:0; display:flex; justify-content:space-between;">
                Today's Quest âš”ï¸
                <span id="medalStatus" style="font-size:1.2rem;">ğŸ¥‰</span>
            </h3>
            <div id="quickTaskList" class="quick-task-grid">
                <div class="quick-task-item" onclick="Tracker.toggle('m1')">
                    <span class="task-check">âšª</span>
                    <span class="task-name">Morning Breathing</span>
                    <span class="task-reward">+10 XP</span>
                </div>
            </div>
        </div>
    </main>

    <main class="screen" id="screen2">
        <div class="intensity-screen">
            <div class="intensity-card">
                <div class="selected-emotion-display" id="selectedEmoji">ğŸ˜Š</div>
                <div class="selected-emotion-name" id="selectedName">Happy</div>
                <p class="intensity-question">How strong is this feeling?</p>
                <div class="intensity-display" id="intensityDisplay">5</div>
                <input type="range" min="1" max="10" value="5" class="intensity-slider" id="intensitySlider" oninput="updateIntensity(this.value)">
                <div class="slider-labels"><span>Mild</span><span>Very Strong</span></div>
            </div>
            
            <div class="note-container" style="margin-top: 20px;">
                <textarea id="emotionNote" placeholder="What's on your mind? (Optional)"></textarea>
            </div>
            
            <button class="btn-primary" onclick="goToResult()">Next</button>
            <button class="btn btn-secondary" onclick="UI.back()">â† Back</button>
        </div>
    </main>

    <main class="screen" id="screen4">
        <div class="result-summary-bar" id="resultSummaryBar">
            <span id="summaryEmoji">ğŸ˜Š</span>
            <span id="summaryText">Happy Level 5</span>
        </div>
        
        <div class="strategies-intro">
            <p class="strategies-subtitle">Try these strategies for you:</p>
        </div>
        <div id="strategiesContainer"></div>
        
        <div class="strategies-footer">
            <button class="btn-primary" onclick="finishCheckIn()">I'm Done</button>
            <button class="btn btn-secondary" onclick="UI.back()">â† Back</button>
        </div>
    </main>

    <main class="screen" id="screen5">
        <div class="result-card">
            <div class="result-emoji">âœ¨</div>
            <p class="result-text" style="font-size: 1.4rem; font-weight: 800; margin-bottom: 12px;">Great job, Joo!</p>
            <p id="finalMessage">Check-in recorded. You're doing great.</p>
            <button class="btn-primary" onclick="startOver()" style="margin-top: 20px;">Check in again</button>
        </div>
    </main>

    <main class="screen" id="screenActivity">
        <div class="activity-container">
            <div class="activity-header">
                <div class="activity-icon" id="activityIcon">ğŸ§¸</div>
                <h2 id="activityTitle">Activity</h2>
            </div>
            <div id="inAppActionArea"></div>
            <div class="activity-footer">
                <button class="btn-primary" id="activityBtn" onclick="finishCheckIn()">Save & Finish</button>
                <button class="btn btn-secondary" onclick="UI.back()">â† Back</button>
            </div>
        </div>
    </main>

    <main class="screen" id="screenHistory">
        <div class="history-container">
            <h2 class="section-title">Emotion Trend</h2>
            <div class="history-card" style="height: 220px; padding: 15px; background:white; border-radius:24px; margin:0 24px;">
                <canvas id="emotionChart"></canvas>
            </div>
            
            <h2 class="section-title">Recent Check-ins</h2>
            <div class="history-list" id="historyList"></div>
            
            <button class="btn-danger" onclick="clearHistory()" style="margin: 20px 24px; width: calc(100% - 48px); border:none; padding:15px; border-radius:15px;">Clear History</button>
        </div>
    </main>

    <main class="screen" id="screenTracker">
        <div class="tracker-container">
            <div class="tracker-tabs">
                <button class="tracker-tab active" id="tabMorning" onclick="switchRoutine('morning')">ğŸŒ… Morning</button>
                <button class="tracker-tab" id="tabEvening" onclick="switchRoutine('evening')">ğŸŒ™ Evening</button>
            </div>

            <div class="progress-card">
                <div class="progress-header">
                    <span id="progressTitle" style="font-weight:850;">Routine</span>
                    <span id="progressFraction" style="color:#7c3aed; font-weight:850;">0/0</span>
                </div>
                <div class="progress-bar-container">
                    <div id="progressBar" class="progress-bar-fill" style="width: 0%"></div>
                </div>
            </div>

            <div id="taskList"></div>

            <div class="sticker-collection">
                <p class="section-title" style="margin-left:0;">ğŸ† Stickers</p>
                <div id="stickerGrid" class="sticker-grid"></div>
            </div>
        </div>
    </main>


    <main class="screen" id="screenSettings">
        <div class="settings-container">
            <h2 class="section-title">Profile</h2>
            <div class="settings-field">
                <label class="settings-label">Your Name</label>
                <input type="text" class="settings-input" id="settingsName" placeholder="Joo" oninput="saveSettings()">
            </div>
            <div class="settings-field">
                <label class="settings-label">Your Age</label>
                <input type="number" class="settings-input" id="settingsAge" placeholder="18" oninput="saveSettings()">
            </div>

            <h2 class="section-title">Data Management</h2>
            <button class="btn-danger" onclick="clearAllData()" style="width: calc(100% - 48px); margin: 0 24px; padding: 18px; border-radius: 20px; border:none;">Reset All Data</button>
            <div id="settingsSaved" style="text-align:center; margin-top:10px; color:#10B981; display:none;">âœ“ Saved!</div>
        </div>
    </main>

    <nav class="bottom-nav">
        <button class="nav-btn active" id="navHome" onclick="goHome()">
            <span class="nav-icon">ğŸ </span>
            <span class="nav-label">Home</span>
        </button>
        <button class="nav-btn" id="navTracker" onclick="goToTracker()">
            <span class="nav-icon">âœ…</span>
            <span class="nav-label">Tracker</span>
        </button>
        <button class="nav-btn" id="navHistory" onclick="goToHistory()">
            <span class="nav-icon">ğŸ“…</span>
            <span class="nav-label">History</span>
        </button>
        <button class="nav-btn" id="navSettings" onclick="goToSettings()">
            <span class="nav-icon">âš™ï¸</span>
            <span class="nav-label">Settings</span>
        </button>
    </nav>
</body>
</html>